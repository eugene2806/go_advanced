## Что такое индекс в базе данных

>Индекс – это объект базы данных, который представляет собой структуру данных, состоящую из ключей,  
>построенных на основе одного или нескольких столбцов таблицы, и указателей, которые сопоставляются  
>с местом фактического хранения заданных данных.

Иными словами, индексы – это некие ссылки на данные, своего рода предметный указатель, по которым можно быстро найти  
и получить фактические данные, т.е. строки таблицы. Основное назначение индексов – это как раз быстрый поиск  
необходимых строк таблицы.

Допустим, Вы постоянно выполняете запрос на получение определенных столбцов таблицы, при этом запрос выполняется долго,  
Вы можете создать индекс, который будет включать один или все эти столбцы (если их не так много).  
И при выполнении запроса сервер будет искать записи уже не в таблице, которая имеет много столбцов,  
ненужных нам в данный момент, а в индексе, в котором он гораздо быстрей найдет необходимые указатели на исходные данные  
и по ним обратится к нужным данным в таблице. А если индекс будет содержать абсолютно все данные (т.е. все столбцы),  
которые Вы хотите получить в запросе, то и обращаться к таблице сервер не будет, а просто вернет данные из индекса,  
это, кстати, называется «Покрытием запроса», а такой индекс «Покрывающим», такие запросы самые быстрые,  
но злоупотреблять этим не стоит, так как с увеличением столбцов в индексе, размер индекса также растет.

## Типы индексов
Существует несколько типов индексов, но здесь обязательно стоит отметить, что в каждой СУБД своя реализация индексов  
и свой синтаксис их создания.

Однако существуют базовые индексы и базовый синтаксис, таким образом, мы можем не углубляться в расширенный синтаксис  
и внутреннее устройство индексов какой-то конкретной СУБД, тем более, что начинающим это и не надо.

Поэтому мы рассмотрим те индексы, которыми Вы будете пользоваться, и которые Вы скорей всего и будете создавать.

Чаще всего Вы будете пользоваться обычным индексом, который и используется для увеличения производительности SQL запросов,  
остальные типы индексов уже более специфичны, и их наличие зависит от того, какие данные хранит база данных,  
т.е. для чего она предназначена.  

## Создание индексов

Давайте перейдем к практике, но сразу скажу, что в реальных ситуациях сначала, перед созданием индекса,  
его необходимо правильно спроектировать, ведь неправильно спроектированный индекс может даже понизить производительность,  
а не увеличить ее.

В наших тестовых таблицах отсутствуют какие-либо индексы, давайте это исправим и потренируемся создавать индексы.

Представим, что к нашей таблице goods мы очень часто обращаемся с условием по категории, столбец category,  
и данных у нас много. Для ускорения инструкций SELECT нам нужен индекс по ключу category.

В SQL индексы создаются с помощью инструкции CREATE INDEX.

```
CREATE INDEX idx_category ON goods
(
category
);
```

*В данном случае мы написали инструкцию CREATE INDEX, затем указали название этого индекса – idx_category.  
Инструкция ON goods говорит о том, что индекс необходимо создать для таблицы goods.  
Потом в скобочках мы указали название столбца, на основе которого у нас будет создан индекс, т.е. category.*

*Такой синтаксис создания индексов поддерживают все СУБД, в таких случаях, без указания каких-то дополнительных  
расширенных параметров, создается индекс по умолчанию, что как раз в большинстве случаев и будет требоваться.*

*В результате выполнения данной инструкции будет создан индекс, который Вы можете посмотреть в обозревателе в определении таблицы*  

## Удаление индекса
Если индекс Вам больше не нужен, Вы его можете удалить. А делается это с помощью инструкции DROP INDEX.

Чтобы удалить созданный ранее индекс, мы можем написать следующую инструкцию, где после DROP INDEX мы пишем название индекса,  
а с помощью инструкции ON goods указываем, к какой таблице относится индекс.  
В PostgreSQL инструкцию ON goods необходимо опустить, так как там индекс относится к схеме,  
к той к которой относится и родительская таблица.  

```
DROP INDEX idx_category ON goods;

-- Для PostgreSQL
DROP INDEX idx_category;
```

### Создание индекса с несколькими ключевыми столбцами

В индексе при его создании в случае необходимости можно указывать не один ключевой столбец, а несколько, например,  
Вы часто в своих запросах в условиях WHERE или объединениях JOIN используете столбцы category и product_name,  
и чтобы повысить производительность запросов, можно создать индекс с двумя ключевыми столбцами.

Чтобы это сделать, необходимо просто добавить дополнительный столбец через запятую.  

```
CREATE INDEX idx_category ON goods
(
product_name,
category
);
```

*Порядок столбцов в таком индексе может влиять на производительность, поэтому сначала рекомендовано указывать столбец,  
который обладает более высокой селективностью, т.е. столбец в котором больше уникальных значений.  
В нашем случае уникальных значений категорий явно меньше, поэтому данный столбец обладает невысокой селективностью  
и мы указываем его вторым.*  

## Создание уникального индекса

Кроме обычного индекса также часто требуется и является очень полезным еще и уникальный индекс.  
Он по сути является обычным индексом, который мы создавали ранее, но дополнительно обеспечивает отсутствие повторяющихся  
(одинаковых) значений ключа индекса, гарантируя тем самым уникальность строк по данному ключу.

Если создавать уникальный индекс по нескольким столбцам, индекс гарантирует уникальность каждой комбинации значений в ключе.  
Уникальный индекс может быть создан только в том случае, если у таблицы на текущий момент отсутствуют дублирующие значения по ключевым столбцам.

Давайте для примера добавим уникальный индекс к таблице categories, допустим, нам нужны только уникальные названия категорий,  
для этого выполняем следующую инструкцию.

```
CREATE UNIQUE INDEX idx_category_name ON categories
(
category_name
);
```

## Создание индекса с включенными столбцами

В индексы кроме ключевых столбов можно добавлять и неключевые столбцы, такие столбцы называются – «Включенные столбцы»,  
т.е. которые не являются ключевыми, но включаются в индекс.  
За счет этого уменьшается количество дисковых операций ввода-вывода и скорость доступа к данным соответственно увеличивается.

Допустим, нам нужно в индекс добавить один ключевой столбец, скажем category, и один неключевой столбец, например, price.  

Чтобы создать индекс с включенными столбцами, необходимо написать обычную инструкцию создания индекса,  
только после перечисления ключевых столбцов написать инструкцию INCLUDE, которая означает, что мы хотим добавить в индекс  
неключевые столбцы. Далее в скобочках мы перечисляем неключевые столбцы индекса, которые будут включаться в индекс.

```
CREATE INDEX idx_category ON goods
(
category
)
INCLUDE (price);
```
